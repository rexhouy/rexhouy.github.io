<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>golang</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="golang"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2015-02-04T22:16+0800"/>
<meta name="author" content="Rex.Houy"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<link rel='stylesheet' type='text/css' href='emacs-org-html-style/org-style.css' media='only screen' />
<link rel='stylesheet' type='text/css' href='emacs-org-html-style/org-style-min-640px.css' media='only screen and (min-width: 640px) and (max-width: 960px)' />
<link rel='stylesheet' type='text/css' href='emacs-org-html-style/org-style-max-640px.css' media='only screen and (max-width: 640px)' />
<script src='https://code.jquery.com/jquery-2.1.3.min.js'></script>
<script src='emacs-org-html-style/nav.js'></script>


</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">golang</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Grammar</a>
<ul>
<li><a href="#sec-1-1">Control structures</a>
<ul>
<li><a href="#sec-1-1-1">If</a></li>
<li><a href="#sec-1-1-2">For</a></li>
<li><a href="#sec-1-1-3">Switch case</a></li>
<li><a href="#sec-1-1-4">Function</a></li>
<li><a href="#sec-1-1-5">Defer</a></li>
</ul>
</li>
<li><a href="#sec-1-2">Type</a>
<ul>
<li><a href="#sec-1-2-1">Struct</a></li>
<li><a href="#sec-1-2-2">Slice</a></li>
<li><a href="#sec-1-2-3">Map</a></li>
<li><a href="#sec-1-2-4">Function</a></li>
</ul>
</li>
<li><a href="#sec-1-3">Class &amp; Interface</a></li>
<li><a href="#sec-1-4">goroutine</a></li>
<li><a href="#sec-1-5">Handle exceptions</a></li>
<li><a href="#sec-1-6">Type</a>
<ul>
<li><a href="#sec-1-6-1">Type search</a></li>
<li><a href="#sec-1-6-2">Type composite</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">Grammar</h2>
<div class="outline-text-2" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1">Control structures</h3>
<div class="outline-text-3" id="text-1-1">


</div>

<div id="outline-container-1-1-1" class="outline-4">
<h4 id="sec-1-1-1">If</h4>
<div class="outline-text-4" id="text-1-1-1">




<pre class="src src-go"><span style="color: #859900;">if</span> err := file.<span style="color: #b58900;">Chmod</span>(0664); err != <span style="color: #268bd2;">nil</span> {
    log.<span style="color: #b58900;">Print</span>(err)
    <span style="color: #859900;">return</span> err
}
</pre>

</div>

</div>

<div id="outline-container-1-1-2" class="outline-4">
<h4 id="sec-1-1-2">For</h4>
<div class="outline-text-4" id="text-1-1-2">




<pre class="src src-go"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Like a C for</span>
<span style="color: #859900;">for</span> init; condition; post { }

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Like a C while</span>
<span style="color: #859900;">for</span> condition { }

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Like a C for(;;)</span>
<span style="color: #859900;">for</span> { }

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Loop</span>
<span style="color: #859900;">for</span> key, value := <span style="color: #859900;">range</span> oldMap {
    newMap[key] = value
}

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Looping over a string</span>
<span style="color: #859900;">for</span> index, char := <span style="color: #859900;">range</span> <span style="color: #2aa198;">"Hello, world!"</span> {
}
</pre>

</div>

</div>

<div id="outline-container-1-1-3" class="outline-4">
<h4 id="sec-1-1-3">Switch case</h4>
<div class="outline-text-4" id="text-1-1-3">




<pre class="src src-go"><span style="color: #859900;">switch</span> {
<span style="color: #859900;">case</span> <span style="color: #2aa198;">'0'</span> &lt;= c &amp;&amp; c &lt;= <span style="color: #2aa198;">'9'</span>:
    <span style="color: #859900;">return</span> c - <span style="color: #2aa198;">'0'</span>
<span style="color: #859900;">case</span> <span style="color: #2aa198;">'a'</span> &lt;= c &amp;&amp; c &lt;= <span style="color: #2aa198;">'f'</span>:
    <span style="color: #859900;">return</span> c - <span style="color: #2aa198;">'a'</span> + 10
<span style="color: #859900;">case</span> <span style="color: #2aa198;">'A'</span> &lt;= c &amp;&amp; c &lt;= <span style="color: #2aa198;">'F'</span>:
    <span style="color: #859900;">return</span> c - <span style="color: #2aa198;">'A'</span> + 10
}

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Match multiple values</span>
<span style="color: #859900;">switch</span> c {
<span style="color: #859900;">case</span> <span style="color: #2aa198;">' '</span>, <span style="color: #2aa198;">'?'</span>, <span style="color: #2aa198;">'&amp;'</span>, <span style="color: #2aa198;">'='</span>, <span style="color: #2aa198;">'#'</span>, <span style="color: #2aa198;">'+'</span>, <span style="color: #2aa198;">'%'</span>:
    <span style="color: #859900;">return</span> <span style="color: #268bd2;">true</span>
}

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">No break</span>
<span style="color: #859900;">switch</span> c {
<span style="color: #859900;">case</span> 1:
    ...
<span style="color: #859900;">case</span> 2:
    <span style="color: #859900;">fallthrough</span>
<span style="color: #859900;">case</span> 3:
    ...
<span style="color: #859900;">default</span>
    ...
}

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Break and jump to label</span>
<span style="color: #268bd2;">Loop</span>:
    <span style="color: #859900;">for</span> n := 0; n &lt; <span style="color: #6c71c4;">len</span>(src); n += size {
        <span style="color: #859900;">switch</span> {
        <span style="color: #859900;">case</span> src[n] &lt; sizeTwo:
            <span style="color: #859900;">if</span> validateOnly {
                <span style="color: #859900;">break</span> <span style="color: #268bd2;">Loop</span>
            }
        }
    }

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Type match</span>
<span style="color: #859900;">switch</span> t := t.(<span style="color: #859900;">type</span>) {
<span style="color: #859900;">default</span>:
    fmt.<span style="color: #b58900;">Printf</span>(<span style="color: #2aa198;">"unexpected type %T"</span>, t)       <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">%T prints whatever type t has</span>
<span style="color: #859900;">case</span> bool:
    fmt.<span style="color: #b58900;">Printf</span>(<span style="color: #2aa198;">"boolean %t\n"</span>, t)             <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">t has type bool</span>
<span style="color: #859900;">case</span> int:
    fmt.<span style="color: #b58900;">Printf</span>(<span style="color: #2aa198;">"integer %d\n"</span>, t)             <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">t has type int</span>
<span style="color: #859900;">case</span> *bool:
    fmt.<span style="color: #b58900;">Printf</span>(<span style="color: #2aa198;">"pointer to boolean %t\n"</span>, *t) <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">t has type *bool</span>
<span style="color: #859900;">case</span> *int:
    fmt.<span style="color: #b58900;">Printf</span>(<span style="color: #2aa198;">"pointer to integer %d\n"</span>, *t) <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">t has type *int</span>
}
</pre>

</div>

</div>

<div id="outline-container-1-1-4" class="outline-4">
<h4 id="sec-1-1-4">Function</h4>
<div class="outline-text-4" id="text-1-1-4">




<pre class="src src-go"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Named result parameters</span>
<span style="color: #859900;">func</span> <span style="color: #b58900;">ReadFull</span>(r <span style="color: #268bd2;">Reader</span>, buf []<span style="color: #268bd2;">byte</span>) (n <span style="color: #268bd2;">int</span>, err <span style="color: #268bd2;">error</span>) {
    <span style="color: #859900;">for</span> <span style="color: #6c71c4;">len</span>(buf) &gt; 0 &amp;&amp; err == <span style="color: #268bd2;">nil</span> {
        <span style="color: #859900;">var</span> nr int
        nr, err = r.<span style="color: #b58900;">Read</span>(buf)
        n += nr
        buf = buf[nr:]
    }
    <span style="color: #859900;">return</span>
}

<span style="color: #859900;">func</span> <span style="color: #b58900;">myfunc</span>(args ...<span style="color: #268bd2;">int</span>) {
    <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">One or more arguments.</span>
    <span style="color: #859900;">for</span> _, arg := <span style="color: #859900;">range</span> args {
    }
}
</pre>

</div>

</div>

<div id="outline-container-1-1-5" class="outline-4">
<h4 id="sec-1-1-5">Defer</h4>
<div class="outline-text-4" id="text-1-1-5">

<p>Same as finally in java
</p>


<pre class="src src-go"><span style="color: #859900;">func</span> <span style="color: #b58900;">Contents</span>(filename <span style="color: #268bd2;">string</span>) (<span style="color: #268bd2;">string</span>, <span style="color: #268bd2;">error</span>) {
    f, err := os.<span style="color: #b58900;">Open</span>(filename)
    <span style="color: #859900;">if</span> err != <span style="color: #268bd2;">nil</span> {
        <span style="color: #859900;">return</span> <span style="color: #2aa198;">""</span>, err
    }
    <span style="color: #859900;">defer</span> f.<span style="color: #b58900;">Close</span>()  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">f.Close will run when we're finished.</span>

    ...
}
</pre>

</div>
</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2">Type</h3>
<div class="outline-text-3" id="text-1-2">


</div>

<div id="outline-container-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">Struct</h4>
<div class="outline-text-4" id="text-1-2-1">




<pre class="src src-go"><span style="color: #859900;">type</span> <span style="color: #268bd2;">Point</span> <span style="color: #859900;">struct</span> {
    X, Y int
}

p := <span style="color: #6c71c4;">new</span>(<span style="color: #268bd2;">Point</span>)  <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">type *Point</span>
p := <span style="color: #268bd2;">Point</span>{X: 3} <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">type Point</span>
</pre>


</div>

</div>

<div id="outline-container-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">Slice</h4>
<div class="outline-text-4" id="text-1-2-2">




<pre class="src src-go"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Array</span>
<span style="color: #859900;">var</span> a = [10]<span style="color: #268bd2;">int</span>
a := []<span style="color: #268bd2;">int</span> {1, 2, 3, 4, 5}
b := a[1:2] <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">return []int{2}</span>
c := a[:2] <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">return []int{1, 2}</span>
d := a[3:] <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">return []int{4, 5}</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Slice</span>
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">make a slice, the length of slice is 0 and capability is 10.</span>
<span style="color: #93a1a1; font-style: italic;">//</span><span style="color: #93a1a1; font-style: italic;">make will initialize a empty array &amp; return a pointer points to that array.</span>
a := <span style="color: #6c71c4;">make</span>([]<span style="color: #268bd2;">int</span>, 0, 10)
a = <span style="color: #6c71c4;">append</span>(a, 1) <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">append value to a, returns the new slice.</span>
a = <span style="color: #6c71c4;">append</span>(a, slice2...) <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">append slice2 to a.</span>
<span style="color: #6c71c4;">copy</span>(dest, src) <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">copy src to dest</span>
capacity := <span style="color: #6c71c4;">cap</span>(a)
length := <span style="color: #6c71c4;">len</span>(a)
</pre>


</div>

</div>

<div id="outline-container-1-2-3" class="outline-4">
<h4 id="sec-1-2-3">Map</h4>
<div class="outline-text-4" id="text-1-2-3">




<pre class="src src-go"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">Use make not new to create a map.</span>
m := <span style="color: #6c71c4;">make</span>(<span style="color: #859900;">map</span>[<span style="color: #268bd2;">int</span>]<span style="color: #268bd2;">string</span>)
m := <span style="color: #6c71c4;">make</span>(<span style="color: #859900;">map</span>[<span style="color: #268bd2;">int</span>]<span style="color: #268bd2;">string</span>, capacity)
m := <span style="color: #859900;">map</span>[<span style="color: #268bd2;">int</span>]<span style="color: #268bd2;">Point</span> {
    <span style="color: #268bd2;">0</span>: {10, 10},
    <span style="color: #268bd2;">1</span>: {20, 20},
}
<span style="color: #6c71c4;">delete</span>(m, 0) <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">remove element from map</span>
point, exist =: m[0] <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">get the value and if the value exists.</span>
</pre>


</div>

</div>

<div id="outline-container-1-2-4" class="outline-4">
<h4 id="sec-1-2-4">Function</h4>
<div class="outline-text-4" id="text-1-2-4">




<pre class="src src-go"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">function is first class type</span>
swap := <span style="color: #859900;">func</span>(x, y <span style="color: #268bd2;">int</span>) (<span style="color: #268bd2;">int</span>, <span style="color: #268bd2;">int</span>) {
    x, y = y, x
    <span style="color: #859900;">return</span> x, y
}

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">closure</span>
<span style="color: #859900;">func</span> <span style="color: #b58900;">sum</span>() (<span style="color: #859900;">func</span>(<span style="color: #268bd2;">int</span>) <span style="color: #268bd2;">int</span>) {
    <span style="color: #859900;">var</span> sum int
    <span style="color: #859900;">return</span> <span style="color: #859900;">func</span>(y <span style="color: #268bd2;">int</span>) <span style="color: #268bd2;">int</span> {
        sum += y
        <span style="color: #859900;">return</span> sum
    }
}
</pre>

</div>
</div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3">Class &amp; Interface</h3>
<div class="outline-text-3" id="text-1-3">

<p>没有类的概念，可以将函数绑定到一个类型来实现。
</p>
<p>
接口实现是隐式的，不需要使用implement来声明类型实现了某个接口
</p>


<pre class="src src-go"><span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">interface from fmt package, like toString in java.</span>
<span style="color: #859900;">type</span> <span style="color: #268bd2;">stringer</span> <span style="color: #859900;">interface</span> {
    <span style="color: #b58900;">String</span>() string
}
</pre>


</div>

</div>

<div id="outline-container-1-4" class="outline-3">
<h3 id="sec-1-4">goroutine</h3>
<div class="outline-text-3" id="text-1-4">




<pre class="src src-go"><span style="color: #859900;">go</span> <span style="color: #b58900;">function</span>(a, b) <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">run function in goroutine</span>

<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">use channel to communication between goroutines.</span>
<span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">channel with buffer, the buffer size is optional</span>
ch := <span style="color: #6c71c4;">make</span>(<span style="color: #859900;">chan</span> <span style="color: #268bd2;">int</span>, 3)
ch &lt;- 1
x, isClosed := &lt;-ch <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">the 2nd value can be used to detect if the channel has been closed.</span>
<span style="color: #6c71c4;">close</span>(ch) <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">close channel</span>
</pre>


</div>

</div>

<div id="outline-container-1-5" class="outline-3">
<h3 id="sec-1-5">Handle exceptions</h3>
<div class="outline-text-3" id="text-1-5">

<p>error interface
</p>


<pre class="src src-go"><span style="color: #859900;">type</span> <span style="color: #268bd2;">error</span> <span style="color: #859900;">interface</span> {
    <span style="color: #b58900;">Error</span>() string
}
</pre>


<p>
panic &amp; recover
</p>


<pre class="src src-go"><span style="color: #859900;">func</span> <span style="color: #6c71c4;">panic</span>(<span style="color: #859900;">interface</span>{})
<span style="color: #859900;">func</span> <span style="color: #6c71c4;">recover</span>() <span style="color: #859900;">interface</span>{}

<span style="color: #859900;">func</span> <span style="color: #b58900;">test</span>() {
    ...
    <span style="color: #859900;">defer</span> <span style="color: #859900;">func</span>() {
        <span style="color: #859900;">if</span> r := <span style="color: #6c71c4;">recover</span>(); r!= <span style="color: #268bd2;">nil</span> { <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">recover from exception</span>
            ...
        }
    }()
    ...
    <span style="color: #6c71c4;">panic</span>(404) <span style="color: #93a1a1; font-style: italic;">// </span><span style="color: #93a1a1; font-style: italic;">throw exception</span>
}
</pre>

</div>

</div>

<div id="outline-container-1-6" class="outline-3">
<h3 id="sec-1-6">Type</h3>
<div class="outline-text-3" id="text-1-6">


</div>

<div id="outline-container-1-6-1" class="outline-4">
<h4 id="sec-1-6-1">Type search</h4>
<div class="outline-text-4" id="text-1-6-1">




<pre class="src src-go"><span style="color: #859900;">func</span> <span style="color: #b58900;">getType</span>(t <span style="color: #859900;">interface</span>{}) <span style="color: #268bd2;">string</span> {
    <span style="color: #859900;">switch</span> t.(<span style="color: #859900;">type</span>) {
    <span style="color: #859900;">case</span> int:
        <span style="color: #859900;">return</span> <span style="color: #2aa198;">"int"</span>
    <span style="color: #859900;">case</span> string:
        <span style="color: #859900;">return</span> <span style="color: #2aa198;">"string"</span>
    }
    <span style="color: #859900;">return</span> <span style="color: #2aa198;">"unknown"</span>
}
</pre>

</div>

</div>

<div id="outline-container-1-6-2" class="outline-4">
<h4 id="sec-1-6-2">Type composite</h4>
<div class="outline-text-4" id="text-1-6-2">




<pre class="src src-go"><span style="color: #859900;">type</span> <span style="color: #268bd2;">Reader</span> <span style="color: #859900;">interface</span> {
    <span style="color: #b58900;">Read</span>(p []<span style="color: #268bd2;">byte</span>) (n int, err error)
}
<span style="color: #859900;">type</span> <span style="color: #268bd2;">Writer</span> <span style="color: #859900;">interface</span> {
    <span style="color: #b58900;">Write</span>(p []<span style="color: #268bd2;">byte</span>) (nint, err error)
}
<span style="color: #859900;">type</span> <span style="color: #268bd2;">ReaderWriter</span> <span style="color: #859900;">interface</span> {
    Reader
    Writer
}
</pre>


<pre class="src src-go"><span style="color: #859900;">type</span> <span style="color: #268bd2;">(</span>
    FileReader <span style="color: #859900;">struct</span>{}
    FileWriter <span style="color: #859900;">struct</span>{}
)
<span style="color: #859900;">func</span> (fReader *<span style="color: #268bd2;">FileReader</span>) <span style="color: #b58900;">Read</span>(p []<span style="color: #268bd2;">byte</span>) (n <span style="color: #268bd2;">int</span>, err <span style="color: #268bd2;">error</span>) {
    ...
}
<span style="color: #859900;">func</span> (fWriter *<span style="color: #268bd2;">FileWriter</span>) <span style="color: #b58900;">Write</span>(p []<span style="color: #268bd2;">byte</span>) (n <span style="color: #268bd2;">int</span>, err <span style="color: #268bd2;">error</span>) {
    ...
}
<span style="color: #859900;">type</span> <span style="color: #268bd2;">File</span> <span style="color: #859900;">struct</span> {
    FileReader
    FileWriter
}
</pre>

</div>
</div>
</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2015-02-04T22:16+0800</p>
<p class="author">Author: Rex.Houy</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
