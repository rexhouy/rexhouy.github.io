<?xml version="1.0" encoding="gbk"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
							 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>plsql</title>
<meta http-equiv="Content-Type" content="text/html;charset=gbk"/>
<meta name="title" content="plsql"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2014-02-07T00:07+0900"/>
<meta name="author" content="rex.houy"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<link rel="stylesheet" type="text/css" href="org-style.css" media="only screen and (min-device-width: 480px)" /><link rel="stylesheet" type="text/css" href="org-style-phone.css" media="only screen and (max-device-width: 480px)" />


</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">plsql</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 注释</a></li>
<li><a href="#sec-2">2 申明变量</a></li>
<li><a href="#sec-3">3 变量类型</a></li>
<li><a href="#sec-4">4 定义类型</a></li>
<li><a href="#sec-5">5 关于NULL</a></li>
<li><a href="#sec-6">6 IF语句</a></li>
<li><a href="#sec-7">7 循环</a></li>
<li><a href="#sec-8">8 GOTO</a></li>
<li><a href="#sec-9">9 CURSOR</a></li>
<li><a href="#sec-10">10 动态SQL</a></li>
<li><a href="#sec-11">11 自定义异常</a></li>
<li><a href="#sec-12">12 PROCEDURE</a></li>
<li><a href="#sec-13">13 FUNCTION</a></li>
<li><a href="#sec-14">14 PACKAGE</a></li>
<li><a href="#sec-15">15 TRIGGER</a></li>
<li><a href="#sec-16">16 example</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 注释</h2>
<div class="outline-text-2" id="text-1">

<p>   &ndash;单行注释
</p>
<p>
	 <i>*多行注释*</i>
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 申明变量</h2>
<div class="outline-text-2" id="text-2">




<pre class="src src-sql">var_name [CONSTANT] var_type [<span style="color: #8ac6f2; font-weight: bold;">NOT</span> NUL] [:=<span style="color: #8ac6f2; font-weight: bold;">value</span>]|[<span style="color: #8ac6f2; font-weight: bold;">DEFAULT</span> <span style="color: #8ac6f2; font-weight: bold;">value</span>];
</pre>


</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 变量类型</h2>
<div class="outline-text-2" id="text-3">


<p>
table.field%TYPE:该类型在运行时可以随着表里字段类型变化，不会继承表的NOT NULL属性；
</p>
<p>
table%rowtype：也可以是cursor%rowtype，从而只得到表的部分字段或多个表的字段；
</p>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 定义类型</h2>
<div class="outline-text-2" id="text-4">




<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">TYPE</span> record_name <span style="color: #8ac6f2; font-weight: bold;">IS</span> RECORD(
 field1 type1 [<span style="color: #8ac6f2; font-weight: bold;">NOT</span> <span style="color: #8ac6f2; font-weight: bold;">NULL</span>] [:=expr1],
 field2 type2 [<span style="color: #8ac6f2; font-weight: bold;">NOT</span> <span style="color: #8ac6f2; font-weight: bold;">NULL</span>] [:=expr2],
 ...
);

<span style="color: #8ac6f2; font-weight: bold;">TYPE</span> some_type <span style="color: #8ac6f2; font-weight: bold;">IS</span> <span style="color: #8ac6f2; font-weight: bold;">TABLE</span> <span style="color: #8ac6f2; font-weight: bold;">OF</span> base_type;
<span style="color: #99968b;">--[example:]</span>
<span style="color: #8ac6f2; font-weight: bold;">DECLARE</span>
 <span style="color: #8ac6f2; font-weight: bold;">TYPE</span> nest_type <span style="color: #8ac6f2; font-weight: bold;">IS</span> <span style="color: #8ac6f2; font-weight: bold;">TABLE</span> <span style="color: #8ac6f2; font-weight: bold;">OF</span> varchar2(10);
 nest nest_type;
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 nest := nest_type(<span style="color: #95e454;">'a'</span>, <span style="color: #95e454;">'b'</span>, <span style="color: #95e454;">'c'</span>);
 <span style="color: #8ac6f2; font-weight: bold;">FOR</span> i <span style="color: #8ac6f2; font-weight: bold;">IN</span> nest.<span style="color: #8ac6f2; font-weight: bold;">FIRST</span> .. nest.<span style="color: #8ac6f2; font-weight: bold;">LAST</span> LOOP
	<span style="color: #8ac6f2; font-weight: bold;">IF</span> nest(i) = <span style="color: #95e454;">'a'</span> <span style="color: #8ac6f2; font-weight: bold;">THEN</span>
	 <span style="color: #8ac6f2; font-weight: bold;">NULL</span>;
	<span style="color: #8ac6f2; font-weight: bold;">END</span> <span style="color: #8ac6f2; font-weight: bold;">IF</span>;
 <span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;
<span style="color: #8ac6f2; font-weight: bold;">END</span>;

<span style="color: #99968b;">--associative array:&#65288;&#31867;&#20284;&#20110;map&#65289;</span>
<span style="color: #8ac6f2; font-weight: bold;">TYPE</span> table_type <span style="color: #8ac6f2; font-weight: bold;">IS</span> <span style="color: #8ac6f2; font-weight: bold;">TABLE</span> <span style="color: #8ac6f2; font-weight: bold;">OF</span> base_type <span style="color: #8ac6f2; font-weight: bold;">INDEX</span> <span style="color: #8ac6f2; font-weight: bold;">BY</span> index_type;
<span style="color: #99968b;">--[example:]</span>
<span style="color: #8ac6f2; font-weight: bold;">DECLARE</span>
 <span style="color: #8ac6f2; font-weight: bold;">TYPE</span> population <span style="color: #8ac6f2; font-weight: bold;">IS</span> <span style="color: #8ac6f2; font-weight: bold;">TABLE</span> <span style="color: #8ac6f2; font-weight: bold;">OF</span> <span style="color: #8ac6f2; font-weight: bold;">NUMBER</span> <span style="color: #8ac6f2; font-weight: bold;">INDEX</span> <span style="color: #8ac6f2; font-weight: bold;">BY</span> VARCHAR2(10);
 county_population population;
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 <span style="color: #e5786d;">count</span> <span style="color: #8ac6f2; font-weight: bold;">NUMBER</span>;
 county_population(<span style="color: #95e454;">'china'</span>) := 10000;
 county_population(<span style="color: #95e454;">'japan'</span>) := 4000;
 <span style="color: #e5786d;">count</span> := county_population(<span style="color: #95e454;">'china'</span>);
<span style="color: #8ac6f2; font-weight: bold;">END</span>

<span style="color: #99968b;">--varray:(&#25968;&#32452;&#65292;&#38656;&#35201;&#25351;&#23450;&#38271;&#24230;)</span>
<span style="color: #99968b;">--&#23450;&#20041;&#19968;&#20010;&#38271;&#24230;&#20026;n&#30340;&#25968;&#32452;&#65292;&#31867;&#22411;&#20026;type&#65292;&#20854;&#20013;type&#19981;&#33021;&#20026;%rowtype</span>
<span style="color: #8ac6f2; font-weight: bold;">TYPE</span> table_type <span style="color: #8ac6f2; font-weight: bold;">IS</span> VARRAY(n) <span style="color: #8ac6f2; font-weight: bold;">OF</span> <span style="color: #8ac6f2; font-weight: bold;">type</span>;
<span style="color: #99968b;">--&#22312;&#36825;&#37324;type&#21487;&#20197;&#26159;%rowtype</span>
<span style="color: #8ac6f2; font-weight: bold;">TYPE</span> table_type <span style="color: #8ac6f2; font-weight: bold;">IS</span> VARRAY <span style="color: #8ac6f2; font-weight: bold;">OF</span> <span style="color: #8ac6f2; font-weight: bold;">type</span>;

<span style="color: #99968b;">--&#36890;&#36807;select&#23558;&#25968;&#25454;&#25554;&#20837;&#21040;&#21464;&#37327;&#20013;&#65306;</span>
<span style="color: #99968b;">--1.&#21333;&#26465;&#35760;&#24405;&#65306;</span>
<span style="color: #8ac6f2; font-weight: bold;">SELECT</span> <span style="color: #8ac6f2; font-weight: bold;">column</span> <span style="color: #8ac6f2; font-weight: bold;">INTO</span> var <span style="color: #e5786d;">FROM</span> <span style="color: #8ac6f2; font-weight: bold;">table</span>&#65307;
<span style="color: #99968b;">--2.&#22810;&#26465;&#35760;&#24405;&#65306;</span>
<span style="color: #8ac6f2; font-weight: bold;">SELECT</span> <span style="color: #8ac6f2; font-weight: bold;">column</span> BULK COLLECT <span style="color: #8ac6f2; font-weight: bold;">INTO</span> var <span style="color: #e5786d;">FROM</span> <span style="color: #8ac6f2; font-weight: bold;">table</span>&#65307;
<span style="color: #99968b;">--[example:]</span>
<span style="color: #8ac6f2; font-weight: bold;">DECLARE</span>
 <span style="color: #8ac6f2; font-weight: bold;">TYPE</span> id_type <span style="color: #8ac6f2; font-weight: bold;">IS</span> <span style="color: #8ac6f2; font-weight: bold;">TABLE</span> <span style="color: #8ac6f2; font-weight: bold;">OF</span> temp.id%<span style="color: #8ac6f2; font-weight: bold;">TYPE</span>;
 all_id id_type;
 single_id id_type;
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 <span style="color: #8ac6f2; font-weight: bold;">SELECT</span> id <span style="color: #8ac6f2; font-weight: bold;">INTO</span> single_id <span style="color: #e5786d;">FROM</span> temp <span style="color: #8ac6f2; font-weight: bold;">WHERE</span> <span style="color: #8ac6f2; font-weight: bold;">name</span>=<span style="color: #95e454;">'xx'</span>; <span style="color: #99968b;">--&#33719;&#21462;&#21333;&#26465;&#25968;&#25454;</span>
 <span style="color: #8ac6f2; font-weight: bold;">SELECT</span> id BULK COLLECT <span style="color: #8ac6f2; font-weight: bold;">INTO</span> all_id <span style="color: #e5786d;">FROM</span> temp;  <span style="color: #99968b;">--&#33719;&#21462;&#22810;&#26465;&#25968;&#25454;</span>
<span style="color: #8ac6f2; font-weight: bold;">END</span>;
/

<span style="color: #99968b;">--&#22312;for&#35821;&#21477;&#20013;&#30452;&#25509;&#23558;&#25968;&#25454;&#25554;&#20837;&#21040;&#21464;&#37327;&#20013;&#65306;</span>
<span style="color: #99968b;">--[example:]</span>
<span style="color: #8ac6f2; font-weight: bold;">DECLARE</span>
 <span style="color: #8ac6f2; font-weight: bold;">TYPE</span> temp_typ <span style="color: #8ac6f2; font-weight: bold;">IS</span> <span style="color: #8ac6f2; font-weight: bold;">TABLE</span> <span style="color: #8ac6f2; font-weight: bold;">OF</span> temp%ROWTYPE;
 item temp_typ;
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 <span style="color: #8ac6f2; font-weight: bold;">FOR</span> item <span style="color: #8ac6f2; font-weight: bold;">in</span> (<span style="color: #8ac6f2; font-weight: bold;">SELECT</span> * <span style="color: #e5786d;">FROM</span> temp)
 LOOP
	dbms_output.put_line(item.<span style="color: #8ac6f2; font-weight: bold;">name</span>);
 <span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;
<span style="color: #8ac6f2; font-weight: bold;">END</span>;
/

<span style="color: #8ac6f2; font-weight: bold;">CASE</span> selector
 <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> expression1 <span style="color: #8ac6f2; font-weight: bold;">THEN</span> result1
 <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> expression2 <span style="color: #8ac6f2; font-weight: bold;">THEN</span> result2
 <span style="color: #8ac6f2; font-weight: bold;">ELSE</span> result3
<span style="color: #8ac6f2; font-weight: bold;">END</span>

<span style="color: #8ac6f2; font-weight: bold;">CASE</span>
 <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> condition1 <span style="color: #8ac6f2; font-weight: bold;">THEN</span> result1
 <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> condition2 <span style="color: #8ac6f2; font-weight: bold;">THEN</span> result2
 <span style="color: #8ac6f2; font-weight: bold;">ELSE</span> result3
<span style="color: #8ac6f2; font-weight: bold;">END</span>
<span style="color: #99968b;">--&#21487;&#29992;&#20110;&#20195;&#26367;&#22823;&#37327;&#30340;if&#35821;&#21477;</span>
</pre>


</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 关于NULL</h2>
<div class="outline-text-2" id="text-5">

<p>  包含NULL的比较语句返回NULL；
	在判断语句的条件中如果得到NULL则该条件语句中的语句不被执行；
	在case语句中使用WHEN NULL，如果selector是NULL该语句内的内容也不会被执行；
</p>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> IF语句</h2>
<div class="outline-text-2" id="text-6">





<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">IF</span> condition <span style="color: #8ac6f2; font-weight: bold;">THEN</span>
 expression
<span style="color: #8ac6f2; font-weight: bold;">ELSEIF</span> condition <span style="color: #8ac6f2; font-weight: bold;">THEN</span>
 expression
<span style="color: #8ac6f2; font-weight: bold;">ELSE</span>
 expression
<span style="color: #8ac6f2; font-weight: bold;">END</span> <span style="color: #8ac6f2; font-weight: bold;">IF</span>;
</pre>


</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> 循环</h2>
<div class="outline-text-2" id="text-7">





<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">FOR</span> i <span style="color: #8ac6f2; font-weight: bold;">IN</span> 1..10 LOOP
 expression;
<span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;

LOOP
 expression&#65307;
 EXIT; <span style="color: #99968b;">--&#31435;&#21363;&#36339;&#20986;&#24490;&#29615;</span>
<span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;

LOOP
 EXIT <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> condition;
<span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;

<span style="color: #99968b;">--&#21487;&#20197;&#36890;&#36807;&#20197;&#19979;&#20004;&#31181;&#26041;&#24335;&#20026;loop&#21462;&#21517;&#24182;&#22312;&#24490;&#29615;&#20013;&#25351;&#23450;&#30452;&#25509;&#36339;&#20986;&#26576;&#19968;&#24490;&#29615;&#12290;</span>
&lt;&lt;laber1&gt;&gt;
LOOP
 <span style="color: #99968b;">--expression&#65307;</span>
LOOP
 <span style="color: #99968b;">--expression&#65307;</span>
 EXIT laber1 <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> condition;
 <span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;
<span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;

LOOP
 LOOP
	EXIT laber1;
 <span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP laber2;
<span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP laber1;


WHILE condition LOOP
 expression
<span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;
</pre>


</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> GOTO</h2>
<div class="outline-text-2" id="text-8">




<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 &lt;&lt;lable&gt;&gt;
 expression;
 <span style="color: #8ac6f2; font-weight: bold;">GOTO</span> lable;
<span style="color: #8ac6f2; font-weight: bold;">END</span>;
</pre>


</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> CURSOR</h2>
<div class="outline-text-2" id="text-9">

<p>使用cursor:
</p>
<p>
定义cursor：
</p>


<pre class="src src-sql">  <span style="color: #8ac6f2; font-weight: bold;">CURSOR</span> <span style="color: #8ac6f2; font-weight: bold;">cursor_name</span>(parameter1 type1, parameter2, type2) <span style="color: #8ac6f2; font-weight: bold;">IS</span> query_string;

<span style="color: #99968b;">--&#36941;&#21382;cursor&#65306;</span>
<span style="color: #99968b;">--&#26041;&#27861;1&#65306;</span>
<span style="color: #8ac6f2; font-weight: bold;">OPEN</span> <span style="color: #8ac6f2; font-weight: bold;">cursor_name</span>
LOOP
 <span style="color: #8ac6f2; font-weight: bold;">fetch</span> <span style="color: #8ac6f2; font-weight: bold;">cursor_name</span> <span style="color: #8ac6f2; font-weight: bold;">into</span> <span style="color: #8ac6f2; font-weight: bold;">variable</span>;
 EXIT <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> <span style="color: #8ac6f2; font-weight: bold;">cursor_name</span>%NOTFOUND;
	...
<span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;
<span style="color: #8ac6f2; font-weight: bold;">CLOSE</span> <span style="color: #8ac6f2; font-weight: bold;">cursor_name</span>;

<span style="color: #99968b;">--&#26041;&#27861;2&#65306;</span>
<span style="color: #8ac6f2; font-weight: bold;">FOR</span> <span style="color: #8ac6f2; font-weight: bold;">variable</span> <span style="color: #8ac6f2; font-weight: bold;">IN</span> <span style="color: #8ac6f2; font-weight: bold;">cursor_name</span> LOOP
 ...
<span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;

<span style="color: #99968b;">--&#26041;&#27861;3&#65306;</span>
<span style="color: #8ac6f2; font-weight: bold;">OPEN</span> <span style="color: #8ac6f2; font-weight: bold;">cursor_name</span>;
<span style="color: #8ac6f2; font-weight: bold;">FETCH</span> <span style="color: #8ac6f2; font-weight: bold;">cursor_name</span> BULK COLLECT <span style="color: #8ac6f2; font-weight: bold;">INTO</span> <span style="color: #8ac6f2; font-weight: bold;">variable</span>;
<span style="color: #8ac6f2; font-weight: bold;">CLOSE</span> <span style="color: #8ac6f2; font-weight: bold;">cursor_name</span>;

<span style="color: #99968b;">--ref cursor:(cursor&#31867;&#20284;&#19982;&#25968;&#32452;&#65292;&#32780;ref cursor&#31867;&#20284;&#20110;&#25351;&#38024;.&#26377;&#20004;&#31181;ref cursor&#65292;&#24369;&#31867;&#22411;(&#19981;&#21547;return)&#21644;&#24378;&#31867;&#22411;(&#21547;&#26377;return))</span>

<span style="color: #99968b;">--&#22312;package&#20013;&#23450;&#20041;cursor type&#65306;</span>
<span style="color: #8ac6f2; font-weight: bold;">create</span> package <span style="color: #cae682;">package_name</span> <span style="color: #8ac6f2; font-weight: bold;">as</span>
 <span style="color: #8ac6f2; font-weight: bold;">type</span> cursor_type_name <span style="color: #8ac6f2; font-weight: bold;">is</span> <span style="color: #92a65e; font-weight: bold;">ref</span> <span style="color: #8ac6f2; font-weight: bold;">cursor</span> [<span style="color: #8ac6f2; font-weight: bold;">return</span> <span style="color: #8ac6f2; font-weight: bold;">table</span>%rowtype];
<span style="color: #8ac6f2; font-weight: bold;">end</span> package_name;

<span style="color: #99968b;">--&#20351;&#29992;package&#20013;&#23450;&#20041;&#30340;cursor&#31867;&#22411;&#65306;</span>
<span style="color: #8ac6f2; font-weight: bold;">create</span> <span style="color: #8ac6f2; font-weight: bold;">procedure</span> <span style="color: #cae682;">procedure_name</span>(p_name <span style="color: #8ac6f2; font-weight: bold;">OUT</span> package_name.cursor_type_name) <span style="color: #8ac6f2; font-weight: bold;">as</span>
<span style="color: #8ac6f2; font-weight: bold;">begin</span>
 <span style="color: #8ac6f2; font-weight: bold;">open</span> p_name <span style="color: #8ac6f2; font-weight: bold;">for</span> <span style="color: #8ac6f2; font-weight: bold;">select</span> * <span style="color: #e5786d;">from</span> ...;
<span style="color: #8ac6f2; font-weight: bold;">end</span>;
</pre>


<p>
PL/SQL执行DML语句后，有四个属性保存在游标属性中，分别为
</p>
<p>
SQL%ROWCOUNT,返回DML语句影响的行数；
</p>
<p>
SQL%FOUND, 返回true如果DML语句影响的行数大于0；
</p>
<p>
SQL%NOTFOUND, 与SQL%FOUND相反；
</p>
<p>
SQL%ISOPEN，返回true如果游标处于打开状态，如果使用隐式的游标如执行insert into&hellip;则将创建一个隐式的游标来处理，则当使用该属性时得到的结果一定为false；
</p>



<pre class="src src-sql"><span style="color: #99968b;">--[example:]</span>
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 <span style="color: #8ac6f2; font-weight: bold;">UPDATE</span> temp <span style="color: #8ac6f2; font-weight: bold;">SET</span> id = id + 1;
 dbms_output.put_line(<span style="color: #8ac6f2; font-weight: bold;">SQL</span>%ROWCOUNT);
<span style="color: #8ac6f2; font-weight: bold;">END</span>;
/ <span style="color: #99968b;">--&#23558;&#24471;&#21040;update&#35821;&#21477;&#25152;&#26356;&#26032;&#30340;&#34892;&#25968;&#12290;</span>
</pre>

</div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> 动态SQL</h2>
<div class="outline-text-2" id="text-10">




<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">variable</span> x <span style="color: #8ac6f2; font-weight: bold;">number</span>;
<span style="color: #8ac6f2; font-weight: bold;">exec</span> :x := 12;
<span style="color: #8ac6f2; font-weight: bold;">SELECT</span> * <span style="color: #e5786d;">FROM</span> some_table <span style="color: #8ac6f2; font-weight: bold;">WHERE</span> some_column = :x;

<span style="color: #99968b;">--&#20351;&#29992;EXECUTE IMMEDIATE&#25191;&#34892;dynamic sql&#12290;&#65288;&#20351;&#29992;USING&#23376;&#21477;&#35774;&#23450;&#21442;&#25968;&#65289;</span>
sql_stmt VARCHAR2(100)
sql_stmt := &#8217;<span style="color: #8ac6f2; font-weight: bold;">INSERT</span> <span style="color: #8ac6f2; font-weight: bold;">INTO</span> dept <span style="color: #8ac6f2; font-weight: bold;">VALUES</span> (:1, :2, :3)&#8217;;
<span style="color: #8ac6f2; font-weight: bold;">EXECUTE</span> <span style="color: #8ac6f2; font-weight: bold;">IMMEDIATE</span> sql_stmt <span style="color: #8ac6f2; font-weight: bold;">USING</span> dept_id, dept_name, location;

plsql_block := <span style="color: #95e454;">'BEGIN create_dept(:a, :b, :c); END;'</span>;
<span style="color: #8ac6f2; font-weight: bold;">EXECUTE</span> <span style="color: #8ac6f2; font-weight: bold;">IMMEDIATE</span> plsql_block <span style="color: #8ac6f2; font-weight: bold;">USING</span> <span style="color: #8ac6f2; font-weight: bold;">IN</span> <span style="color: #8ac6f2; font-weight: bold;">OUT</span> new_deptno, new_dname, new_loc;

<span style="color: #99968b;">--(&#20351;&#29992;forall&#25191;&#34892;&#21442;&#25968;&#21015;&#34920;, returning&#33719;&#24471;&#38656;&#35201;&#30340;&#36820;&#22238;&#20540; )</span>
empnos := NumList(1,2,3,4,5);
FORALL i <span style="color: #8ac6f2; font-weight: bold;">IN</span> 1..5
<span style="color: #8ac6f2; font-weight: bold;">EXECUTE</span> <span style="color: #8ac6f2; font-weight: bold;">IMMEDIATE</span>
<span style="color: #95e454;">'UPDATE emp SET sal = sal * 1.1 WHERE empno = :1 RETURNING ename INTO :2'</span>
<span style="color: #8ac6f2; font-weight: bold;">USING</span> empnos(i) RETURNING BULK COLLECT <span style="color: #8ac6f2; font-weight: bold;">INTO</span> enames;
</pre>


</div>

</div>

<div id="outline-container-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> 自定义异常</h2>
<div class="outline-text-2" id="text-11">




<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">DECLARE</span>
 e_name <span style="color: #8ac6f2; font-weight: bold;">EXCEPTION</span>;
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 RAISE e_name;
 <span style="color: #8ac6f2; font-weight: bold;">EXCEPTION</span>
 <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> e_name <span style="color: #8ac6f2; font-weight: bold;">THEN</span> ...
<span style="color: #8ac6f2; font-weight: bold;">END</span>;
</pre>


</div>

</div>

<div id="outline-container-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> PROCEDURE</h2>
<div class="outline-text-2" id="text-12">




<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">CREATE</span> [<span style="color: #8ac6f2; font-weight: bold;">OR</span> <span style="color: #e5786d;">REPLACE</span>] <span style="color: #8ac6f2; font-weight: bold;">PROCEDURE</span> proc_name (
 arg_name1   <span style="color: #8ac6f2; font-weight: bold;">IN</span>      type1,
 arg_name2   <span style="color: #8ac6f2; font-weight: bold;">OUT</span>     type2,
 arg_name3   <span style="color: #8ac6f2; font-weight: bold;">IN</span> <span style="color: #8ac6f2; font-weight: bold;">OUT</span>  type3 )
<span style="color: #8ac6f2; font-weight: bold;">AS</span>
 var1  type1 [:=value1];
 var2  type2 [:=value2];
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 ...
<span style="color: #8ac6f2; font-weight: bold;">EXCEPTION</span>
 ...
<span style="color: #8ac6f2; font-weight: bold;">END</span>;
</pre>


</div>

</div>

<div id="outline-container-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> FUNCTION</h2>
<div class="outline-text-2" id="text-13">




<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">CREATE</span> [<span style="color: #8ac6f2; font-weight: bold;">OR</span> <span style="color: #e5786d;">REPLACE</span>] <span style="color: #8ac6f2; font-weight: bold;">FUNCTION</span> func_name
 (args...)
 <span style="color: #8ac6f2; font-weight: bold;">RETURN</span> type1
<span style="color: #8ac6f2; font-weight: bold;">AS</span>
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 ...
<span style="color: #8ac6f2; font-weight: bold;">END</span>;
</pre>


</div>

</div>

<div id="outline-container-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> PACKAGE</h2>
<div class="outline-text-2" id="text-14">




<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">CREATE</span> [<span style="color: #8ac6f2; font-weight: bold;">OR</span> <span style="color: #e5786d;">REPLACE</span>] PACKAGE pack_name <span style="color: #8ac6f2; font-weight: bold;">AS</span>
 <span style="color: #8ac6f2; font-weight: bold;">PROCEDURE</span> procedure_name;
 <span style="color: #8ac6f2; font-weight: bold;">FUNCTION</span> function_name;
	variables...
	types...
	exceptions...
	cursors...
 <span style="color: #8ac6f2; font-weight: bold;">END</span> pack_name;

 <span style="color: #8ac6f2; font-weight: bold;">CREATE</span> [<span style="color: #8ac6f2; font-weight: bold;">OR</span> <span style="color: #e5786d;">REPLACE</span>] PACKAGE BODY pack_name <span style="color: #8ac6f2; font-weight: bold;">AS</span>
 <span style="color: #8ac6f2; font-weight: bold;">PROCEDURE</span> procedure_name <span style="color: #8ac6f2; font-weight: bold;">AS</span>
 <span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
	...
 <span style="color: #8ac6f2; font-weight: bold;">END</span>

 <span style="color: #8ac6f2; font-weight: bold;">FUNCTION</span> function_name <span style="color: #8ac6f2; font-weight: bold;">AS</span>
 <span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
	...
 <span style="color: #8ac6f2; font-weight: bold;">END</span>

 variables...
 types...
 exceptions...
 cursors...
<span style="color: #8ac6f2; font-weight: bold;">END</span> pack_name;
</pre>


</div>

</div>

<div id="outline-container-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> TRIGGER</h2>
<div class="outline-text-2" id="text-15">




<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">CREATE</span> [<span style="color: #8ac6f2; font-weight: bold;">OR</span> <span style="color: #e5786d;">REPLACE</span>] <span style="color: #8ac6f2; font-weight: bold;">TRIGGER</span> <span style="color: #8ac6f2; font-weight: bold;">trigger_name</span>
 {<span style="color: #8ac6f2; font-weight: bold;">BEFORE</span>|<span style="color: #8ac6f2; font-weight: bold;">AFTER</span>|INSTEAD <span style="color: #8ac6f2; font-weight: bold;">OF</span>} trigger_event <span style="color: #8ac6f2; font-weight: bold;">ON</span> <span style="color: #8ac6f2; font-weight: bold;">table_name</span>
 [<span style="color: #8ac6f2; font-weight: bold;">FOR</span> <span style="color: #8ac6f2; font-weight: bold;">EACH</span> <span style="color: #92a65e; font-weight: bold;">ROW</span> [<span style="color: #8ac6f2; font-weight: bold;">WHEN</span> condition]]
<span style="color: #8ac6f2; font-weight: bold;">DECLARE</span>
 ...
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 ...
<span style="color: #8ac6f2; font-weight: bold;">END</span>;
</pre>


</div>

</div>

<div id="outline-container-16" class="outline-2">
<h2 id="sec-16"><span class="section-number-2">16</span> example</h2>
<div class="outline-text-2" id="text-16">




<pre class="src src-sql"><span style="color: #8ac6f2; font-weight: bold;">DECLARE</span>
 <span style="color: #8ac6f2; font-weight: bold;">TYPE</span> emp_cur_typ <span style="color: #8ac6f2; font-weight: bold;">IS</span> <span style="color: #92a65e; font-weight: bold;">REF</span> <span style="color: #8ac6f2; font-weight: bold;">CURSOR</span>;
 emp_cur emp_cur_typ;
 dept_name departments.department_name%<span style="color: #8ac6f2; font-weight: bold;">TYPE</span>;
 emp_name employees.last_name%<span style="color: #8ac6f2; font-weight: bold;">TYPE</span>;
 <span style="color: #8ac6f2; font-weight: bold;">CURSOR</span> c1 <span style="color: #8ac6f2; font-weight: bold;">IS</span> <span style="color: #8ac6f2; font-weight: bold;">SELECT</span> department_name,
 <span style="color: #8ac6f2; font-weight: bold;">CURSOR</span>(<span style="color: #8ac6f2; font-weight: bold;">SELECT</span> e.last_name <span style="color: #e5786d;">FROM</span> employees e <span style="color: #8ac6f2; font-weight: bold;">WHERE</span> e.department_id = d.department_id) employees <span style="color: #e5786d;">FROM</span> departments d  <span style="color: #8ac6f2; font-weight: bold;">WHERE</span> department_name <span style="color: #8ac6f2; font-weight: bold;">like</span> <span style="color: #95e454;">'A%'</span>;
<span style="color: #8ac6f2; font-weight: bold;">BEGIN</span>
 <span style="color: #8ac6f2; font-weight: bold;">OPEN</span> c1;
 LOOP
	<span style="color: #8ac6f2; font-weight: bold;">FETCH</span> c1 <span style="color: #8ac6f2; font-weight: bold;">INTO</span> dept_name, emp_cur;
	EXIT <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> c1%NOTFOUND;
	dbms_output.put_line(<span style="color: #95e454;">'Department: '</span> || dept_name);
	LOOP
	 <span style="color: #8ac6f2; font-weight: bold;">FETCH</span> emp_cur <span style="color: #8ac6f2; font-weight: bold;">INTO</span> emp_name;
	 EXIT <span style="color: #8ac6f2; font-weight: bold;">WHEN</span> emp_cur%NOTFOUND;
	 dbms_output.put_line(<span style="color: #95e454;">' Employee: '</span> || emp_name);
	<span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;
 <span style="color: #8ac6f2; font-weight: bold;">END</span> LOOP;
 <span style="color: #8ac6f2; font-weight: bold;">CLOSE</span> c1;
<span style="color: #8ac6f2; font-weight: bold;">END</span>;
/
</pre>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2014-02-07T00:07+0900</p>
<p class="author">Author: rex.houy</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
